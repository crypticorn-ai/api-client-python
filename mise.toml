[tools]
uv = "0.9.9"

# https://mise.jdx.dev/mise-cookbook/python.html#mise-uv
[env]
_.python.venv = { path = ".venv" }

[tasks.lint]
run = "uvx pre-commit run --all-files"
description = "Run pre-commit hooks"

[tasks.test]
run = "uv run pytest tests/"
description = "Run tests with pytest"

[tasks."test:cov"]
run = "uv run pytest tests/ --cov=crypticorn --cov-report=html --cov-report=term"
description = "Run tests with coverage report"

[tasks.install]
run = "uv sync"
alias = "i"
description = "Install dependencies (alias: 'i')"

[tasks."install:upgrade"]
run = "uv sync --upgrade"
description = "Upgrade dependencies in the allowed ranges"

[tasks."install:check"]
run = "uv tree --outdated --depth 1"
description = "Check dependencies for updates"

[tasks.setup]
run = ["mise install", "uvx pre-commit install"]
description = "Setup the project"

[tasks.build]
run = "uv build"
description = "Build the package"

[tasks."version:dry"]
run = "uvx --from 'python-semantic-release==10.4.1' semantic-release --noop -c pyproject.toml version"
description = "Dry run version bump"

[tasks.generate]
description = "Generate API clients (alias: 'g')"
usage = '''
arg "service" "Service to generate (trade, hive, auth, metrics, dex, notification, pay, indicator, klines)"
flag "--env <env>" "Environment (local, dev, prod)" default="local"
flag "--version <version>" "API version (v1, v2)" default="v1"
'''
alias = "g"
run = "uv run generate.py {{arg(name='service')}} --env {{flag(name='env')}} --version {{flag(name='version')}}"

[tasks.clean]
run = "rm -rf build/ dist/ *.egg-info/ .pytest_cache/ htmlcov/ .coverage"
description = "Clean build artifacts and cache files"
